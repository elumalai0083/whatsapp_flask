<!DOCTYPE html>
<html>
<head>
<title>Private Chat</title>

<link rel="stylesheet" href="/static/style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.1/socket.io.js"></script>

<style>

.private-box{
    width:850px;
    margin:auto;
    margin-top:120px;
    background:rgba(0,0,0,0.50);
    padding:25px;
    border-radius:25px;
    box-shadow:0 0 35px black;
    border:1px solid rgba(255,255,255,0.3);
}

.private-area{
    width:100%;
    height:350px;
    overflow-y:auto;
    background:rgba(255,255,255,0.08);
    border-radius:18px;
    padding:15px;
    border:1px solid rgba(255,255,255,0.4);
}

.file-box{
    margin-top:15px;
    display:flex;
    justify-content:center;
    gap:12px;
}

</style>

</head>

<body>

<h1 style="text-align:center;margin-top:40px;">üí¨ Chat with: {{friend}}</h1>

<div class="private-box">

<div id="messages" class="private-area">

{% for m in history %}

{% if m['sender']==session['name'] %}

<div class="msg me">

    {% if m['file'] %}
    <a href="/static/files/{{m['file']}}" target="_blank" style="color:white;">üìÅ File</a>
    {% endif %}

    <p class="text">{{m['message']}}</p>

    <span class="time">{{m['time']}} ‚Äî
    {% if m['read']==1 %}
        <span style="color:red;">‚úî‚úî</span>
    {% else %}
        <span style="color:white;">‚úî</span>
    {% endif %}
    </span>

</div>

{% else %}

<div class="msg other">

    {% if m['file'] %}
    <a href="/static/files/{{m['file']}}" target="_blank" style="color:black;">üìÅ File</a>
    {% endif %}

    <p class="text">{{m['message']}}</p>
    <span class="time">{{m['time']}}</span>

</div>

{% endif %}

{% endfor %}

</div>


<div class="send-box">
    <input id="msg" placeholder="Type Message...">
    <button id="send">Send</button>
</div>


<form class="file-box" action="/upload/{{friend}}" method="POST" enctype="multipart/form-data">
    <input type="file" name="file" required>
    <button style="background:#008cff;color:white;border-radius:10px;padding:10px 15px;font-size:15px;">
        Send File
    </button>
</form>

</div>


<script>

var socket = io();

socket.emit("join_private",{
    sender:"{{session['name']}}",
    receiver:"{{friend}}"
});

document.getElementById("send").onclick = function(){

    let m = msg.value.trim();
    if(m=="") return;

    socket.emit("private_send",{
        sender:"{{session['name']}}",
        receiver:"{{friend}}",
        message:m
    });

    msg.value="";
}

socket.on("private_receive",function(d){

    let box=document.getElementById("messages");
    let t=(d.sender=="{{session['name']}}")?"me":"other";

    box.innerHTML+=`
    <div class="msg ${t}">
        <p class="text">${d.message}</p>
        <span class="time">${d.time}</span>
    </div>
    `;

    box.scrollTop=box.scrollHeight;
});
</script>

</body>
</html>
